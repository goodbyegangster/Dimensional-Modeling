# Design Tip #128 Selecting Default Values for Nulls

[Design Tip #43 Dealing with Nulls in the Dimensional Model](https://www.kimballgroup.com/2003/02/design-tip-43-dealing-with-nulls-in-the-dimensional-model/) では、ディメンショナルモデルで Null 値を避けるべき 2 つのケースを説明しました。これらの場合には Null 値を使うのではなく、デフォルト値を使用することを推奨しました。

本稿では、その際にどのように「意味のある」「説明的な」デフォルト値を選ぶべきかについてガイドします。

## Nulls as Fact Table Foreign Keys

最初の避けるべきケースは、ETL 処理中にファクトテーブルの行に対して「外部キーが Null」となる場合です。

この場合必ず何らかの対応が必要です。なぜなら、ファクトテーブルに実際の Null 外部キーが入ると参照整合性を壊してしまうためです。DBMS によっては禁止されていることもあります。

外部キーを欠いてしまう理由はいくつかあります。

- ソースシステムから提供されたキー値が無効または誤っている（データ品質の問題）
- 当該ファクト行にそのディメンションがそもそも適用できない場合
- 外部キー値がソースデータに存在しない場合
  - これは単なる欠損データ（品質問題）であるケースもあれば
  - イベントがまだ発生していないため、正当に「未知」である場合もあります（典型的には「蓄積スナップショット・ファクトテーブル」に見られる状況です）

Null 外部キーを扱う際は、ETL プロセスで可能な限り「意味を持たせる」ように工夫するべきです。単に「デフォルト行」を 1 行だけ作り、すべてのケースをそこにまとめるのでは不十分です。それぞれの条件を区別して考え、必要なだけデフォルト行を用意し、ビジネスユーザーにとって可能な限り多くの意味を提供するべきです。

最低限、次のようなデフォルト行を持つことを検討してください。

- Missing Value（欠損値）
  - ソースシステムがキー値を提供しなかった
  - ETL 側のデータフィード欠落を示す可能性がある
- Not Happened Yet（未発生）
  - 外部キーは後で得られる見込みがある（まだイベントが発生していない）
- Bad Value（不正値）
  - ソースが誤ったデータまたは不十分なデータを提供した
  - この場合、ソースデータの破損、もしくはビジネスルールの理解不足が原因かもしれない
- Not Applicable（該当せず）
  - このファクト行にはこのディメンションは適用されない

## Nulls as Facts

この場合、ヌル値には 2 つの意味があります。値が存在しなかったか、計測システムが値を捕捉できなかったかのどちらかです。

いずれにせよ、ほとんどのデータベース製品は SUM、MAX、MIN、COUNT、AVG などの集計関数で Null を適切に処理するため、通常は Null のままにしておきます。代わりにゼロを代入すると、これらの集計計算に不適切な影響を与えることになります。

## Nulls as Dimension Attributes

タイミングにより、ディメンションの属性が NULL になることがあります。

例えば、すべての属性がまだキャプチャされていないため、一定期間の属性が不明な場合があります。これらのフィールドに NULL を入力すると、レポートやプル・ダウン・メニューで空白として表示され、検索に特殊なクエリ構文が必要になるため、ユーザが混乱する可能性があります。代わりに、`Unknown` や `Not provided` のような適切な説明文字列を代入することをお勧めします。

---

多くのデータマイニングツールは、NULL を追跡するための異なるテクニックを持っていることに注意してください。上記の推奨事項以外の追加作業が必要になる場合があります。

[Design Tip #128 Selecting Default Values for Nulls](https://www.kimballgroup.com/2010/10/design-tip-128-selecting-default-values-for-nulls/)
