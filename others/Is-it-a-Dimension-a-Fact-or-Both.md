# Design Tip #140 Is it a Dimension, a Fact, or Both?

ほとんどの主題領域では、主要なディメンションを特定するのは比較的簡単です。たとえば、「商品」「顧客アカウント」「学生」「従業員」「組織」などは、説明的なディメンションとして容易に理解できます。また、「店舗の売上」「通信会社の通話記録」「大学の履修登録」などは、明らかにファクト（事実）として扱われます。

しかし、特定の主題領域では、特にディメンショナルモデリングに不慣れな人にとって、あるエンティティがディメンションなのかファクトなのかを判断するのが難しい場合があります。たとえば、保険会社の請求処理部門が「未処理の保険請求」を分析・報告したいと考えたとします。「保険請求（Claim）」はディメンションのように思えますが、同時にファクトテーブルのように振る舞うこともあります。同様に、販売サイクルが長いソフトウェア会社では、「販売機会（Sales Opportunity）」がディメンションなのかファクトなのか、あるいはその両方なのかを判断するのが難しい場合があります。

多くの場合、この設計上の課題は、**ファクトテーブルで表現しようとしているビジネスイベントが、実際には長期間にわたるプロセスやライフサイクルであることを認識することで解決できます**。ビジネスユーザーは、プロセスの現在の状態を最も重視することが多いです。たとえば、「1 つの請求」や「1 つの販売機会」に対して 1 行ずつ持つテーブルは、ディメンションテーブルのように思えます。しかし、「エンティティ（請求や販売機会）」と「プロセス（請求の精算や販売パイプライン）」を区別すると、より明確になります。プロセスを測定するためにはファクトテーブルが必要であり、そのプロセスで測定されるエンティティの属性を記述するためには、複数のディメンションテーブルが必要になります。

このようなスキーマは「累積スナップショット（Accumulating Snapshot）」として実装されます。累積スナップショットは、トランザクション型や定期スナップショット型のファクトテーブルほど一般的ではありません。このタイプのファクトテーブルの粒度は「1 プロセスにつき 1 行」となり、日付ディメンションが複数の役割を持ちます。また、プロセスのライフサイクルの中で、ファクトテーブルの行が何度も更新されるため、「累積スナップショット」と呼ばれます。累積スナップショット型のファクトテーブルについて詳しく知りたい場合は、『The Data Warehouse Toolkit』の 128 ～ 134 ページを参照してください。

累積スナップショットスキーマの主要なディメンションの多くは簡単に特定できますが、設計上の課題もあります。長期間にわたるプロセスでは、ソースシステムから取得される多くの小さなフラグやコードがあり、これらはプロセスのさまざまな状態や条件を示します。これらのフラグやコードは、「ジャンクディメンション（Junk Dimension）」としてまとめるのに適しています。累積スナップショットスキーマには、複数のジャンクディメンションが含まれることを想定しておくべきです。

私は、累積スナップショットのファクトテーブルと同じ行数を持つディメンションを作成することを避けるようにしています。これは、ジャンクディメンションを論理的に関連するグループに分けていない場合に発生する可能性があります。また、先ほどの例では、「保険請求」や「販売機会」のテキスト記述を格納するディメンションをできるだけ作成しないようにしています。しかし、現実的には、ビジネスユーザーがどうしても確認したい詳細情報（例えば、事故報告書や販売機会の説明など）が存在することが多いです。このようなディメンションは非常に大きくなる可能性がありますが、通常、ビジネスユーザーは他のディメンションでデータを絞り込んだ後にのみアクセスするため、テキストデータに一貫した構造がない場合でも問題になりにくいでしょう。

[Design Tip #140 Is it a Dimension, a Fact, or Both?](https://www.kimballgroup.com/2011/11/design-tip-140-is-it-a-dimension-a-fact-or-both/)
